
{% extends "layout.html" %}
{% block content %}
    <div id="app-container" class="max-w-5xl mx-auto">
        <!-- Botões de Ação -->
        <div class="flex flex-wrap justify-center gap-4 mb-6 no-print">
            <button id="btn-download" class="bg-blue-800 hover:bg-blue-900 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                Download Ficha
            </button>
            <button id="btn-upload" class="bg-green-800 hover:bg-green-900 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                Upload Ficha
            </button>
            <input type="file" id="upload-input" class="hidden" accept=".json">
            <button id="btn-pdf" class="bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                Baixar PDF
            </button>
            <button id="btn-limpar" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                Limpar Ficha
            </button>
        </div>

        <!-- Container da Ficha -->
        <div id="ficha-container" class="parchment p-6 rounded-lg">
            
            <!-- Cabeçalho -->
            <header class="border-b-2 border-red-900 pb-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="personagem" class="font-medieval text-red-900 text-lg">Nome do Personagem</label>
                        <input type="text" id="personagem" name="personagem" class="w-full p-2 bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600 transition">
                    </div>
                    <div>
                        <label for="jogador" class="font-medieval text-red-900 text-lg">Jogador(a)</label>
                        <input type="text" id="jogador" name="jogador" class="w-full p-2 bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600 transition">
                    </div>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8">
                <!-- COLUNA DA ESQUERDA -->
                <div class="space-y-6">
                    <!-- Informações Básicas -->
                    <section class="grid grid-cols-5 gap-4">
                        <div class="col-span-1"><label for="raca" class="font-medieval text-red-900">Raça</label><select id="raca" name="raca" class="w-full p-1 bg-transparent border-b-2 border-red-800 rounded-md focus:outline-none focus:border-red-600 transition"><option value="">Selecione</option><option>Humano</option><option>Anão</option><option>Dahllan</option><option>Elfo</option><option>Goblin</option><option>Lefou</option><option>Minotauro</option><option>Qareen</option><option>Golem</option><option>Hynne</option><option>Kliren</option><option>Medusa</option><option>Osteon</option><option>Sereia/Tritão</option><option>Sílfide</option><option>Suraggel</option><option>Trog</option></select></div>
                        <div class="col-span-2"><label for="origem" class="font-medieval text-red-900">Origem</label><select id="origem" name="origem" class="w-full p-1 bg-transparent border-b-2 border-red-800 rounded-md focus:outline-none focus:border-red-600 transition"><option value="">Selecione</option><option>Acólito</option><option>Amnésico</option><option>Aristocrata</option><option>Artesão</option><option>Artista</option><option>Assistente de Laboratório</option><option>Batedor</option><option>Capanga</option><option>Charlatão</option><option>Circense</option><option>Combatente de Arena</option><option>Criminoso</option><option>Curandeiro</option><option>Eremita</option><option>Escravo</option><option>Estudioso</option><option>Fazendeiro</option><option>Forasteiro</option><option>Guarda</option><option>Herdeiro</option><option>Herói Camponês</option><option>Marujo</option><option>Mateiro</option><option>Membro de Guilda</option><option>Mercador</option><option>Minerador</option><option>Nômade</option><option>Pivete</option><option>Refugiado</option><option>Seguidor</option><option>Selvagem</option><option>Soldado</option><option>Taverneiro</option><option>Trabalhador</option><option>Outra</option></select></div>
                        <div class="col-span-2"><label for="classe" class="font-medieval text-red-900">Classe</label><select id="classe" name="classe" class="w-full p-1 bg-transparent border-b-2 border-red-800 rounded-md focus:outline-none focus:border-red-600 transition"><option value="">Selecione</option><option>Arcanista</option><option>Bárbaro</option><option>Bardo</option><option>Bucaneiro</option><option>Caçador</option><option>Cavaleiro</option><option>Clérigo</option><option>Druida</option><option>Guerreiro</option><option>Inventor</option><option>Ladino</option><option>Lutador</option><option>Nobre</option><option>Paladino</option></select></div>
                    </section>

                    <!-- Atributos -->
                    <section class="grid grid-cols-6 gap-2 text-center">
                        <div class="atributo-container" data-attr="for"><label class="font-medieval text-red-900 text-lg">FOR</label><div class="flex flex-col items-center justify-center"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="increment">▲</button><input type="number" id="for" name="for" value="0" min="-5" max="10" class="w-14 h-14 text-3xl font-bold text-center bg-transparent border-2 border-red-800 rounded-lg my-1"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="decrement">▼</button></div></div>
                        <div class="atributo-container" data-attr="des"><label class="font-medieval text-red-900 text-lg">DES</label><div class="flex flex-col items-center justify-center"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="increment">▲</button><input type="number" id="des" name="des" value="0" min="-5" max="10" class="w-14 h-14 text-3xl font-bold text-center bg-transparent border-2 border-red-800 rounded-lg my-1"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="decrement">▼</button></div></div>
                        <div class="atributo-container" data-attr="con"><label class="font-medieval text-red-900 text-lg">CON</label><div class="flex flex-col items-center justify-center"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="increment">▲</button><input type="number" id="con" name="con" value="0" min="-5" max="10" class="w-14 h-14 text-3xl font-bold text-center bg-transparent border-2 border-red-800 rounded-lg my-1"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="decrement">▼</button></div></div>
                        <div class="atributo-container" data-attr="int"><label class="font-medieval text-red-900 text-lg">INT</label><div class="flex flex-col items-center justify-center"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="increment">▲</button><input type="number" id="int" name="int" value="0" min="-5" max="10" class="w-14 h-14 text-3xl font-bold text-center bg-transparent border-2 border-red-800 rounded-lg my-1"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="decrement">▼</button></div></div>
                        <div class="atributo-container" data-attr="sab"><label class="font-medieval text-red-900 text-lg">SAB</label><div class="flex flex-col items-center justify-center"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="increment">▲</button><input type="number" id="sab" name="sab" value="0" min="-5" max="10" class="w-14 h-14 text-3xl font-bold text-center bg-transparent border-2 border-red-800 rounded-lg my-1"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="decrement">▼</button></div></div>
                        <div class="atributo-container" data-attr="car"><label class="font-medieval text-red-900 text-lg">CAR</label><div class="flex flex-col items-center justify-center"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="increment">▲</button><input type="number" id="car" name="car" value="0" min="-5" max="10" class="w-14 h-14 text-3xl font-bold text-center bg-transparent border-2 border-red-800 rounded-lg my-1"><button class="atributo-seta text-red-800 text-lg font-bold" data-action="decrement">▼</button></div></div>
                    </section>

                    <!-- PV e PM -->
                    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 border-2 border-red-800 rounded-lg text-center"><h3 class="font-medieval text-red-900 text-xl mb-2">Pontos de Vida</h3><div class="flex justify-around items-center"><div><label for="pv-max" class="block text-sm">Máx.</label><input type="number" id="pv-max" name="pv-max" value="0" class="w-20 p-2 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div><div><label for="pv-atuais" class="block text-sm">Atuais</label><input type="number" id="pv-atuais" name="pv-atuais" value="0" class="w-20 p-2 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div></div></div>
                        <div class="p-4 border-2 border-red-800 rounded-lg text-center"><h3 class="font-medieval text-red-900 text-xl mb-2">Pontos de Mana</h3><div class="flex justify-around items-center"><div><label for="pm-max" class="block text-sm">Máx.</label><input type="number" id="pm-max" name="pm-max" value="0" class="w-20 p-2 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div><div><label for="pm-atuais" class="block text-sm">Atuais</label><input type="number" id="pm-atuais" name="pm-atuais" value="0" class="w-20 p-2 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div></div></div>
                    </section>

                    <!-- Ataques -->
                    <section>
                         <h3 class="font-medieval text-red-900 text-2xl border-b-2 border-red-900 pb-2 mb-4">Ataques</h3>
                         <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-red-900 uppercase"><tr><th class="p-1">Ataque</th><th class="p-1">Bônus</th><th class="p-1">Dano</th><th class="p-1">Crítico</th><th class="p-1">Tipo</th><th class="p-1">Alcance</th></tr></thead>
                                <tbody id="ataques-tabela"></tbody>
                            </table>
                            <button id="add-ataque-row" class="mt-2 text-sm text-red-800 hover:text-red-600">+ Adicionar Ataque</button>
                         </div>
                    </section>

                    <!-- Defesa e outros -->
                    <section class="space-y-4">
                        <div class="p-4 border-2 border-red-800 rounded-lg text-center flex flex-col justify-center">
                             <h3 class="font-medieval text-red-900 text-xl mb-4">Defesa</h3>
                             <div class="flex flex-col items-center justify-center gap-4">
                                 <div class="flex items-center justify-center gap-2 sm:gap-3 flex-wrap">
                                    <span class="text-2xl font-bold">10 +</span>
                                    <div class="flex flex-col items-center"><label for="defesa-des" class="text-xs">Destreza</label><input type="number" id="defesa-des" readonly class="w-12 p-1 text-center bg-stone-200 border border-red-800 rounded-md"></div>
                                    <span class="text-2xl font-bold">+</span>
                                    <div class="flex flex-col items-center"><label for="bonus-armadura" class="text-xs">Armadura</label><input type="number" id="bonus-armadura" readonly class="w-12 p-1 text-center bg-stone-200 border border-red-800 rounded-md"></div>
                                    <span class="text-2xl font-bold">+</span>
                                    <div class="flex flex-col items-center"><label for="bonus-escudo" class="text-xs">Escudo</label><input type="number" id="bonus-escudo" readonly class="w-12 p-1 text-center bg-stone-200 border border-red-800 rounded-md"></div>
                                    <span class="text-2xl font-bold">+</span>
                                    <div class="flex flex-col items-center"><label for="defesa-outros" class="text-xs">Outros</label><input type="number" id="defesa-outros" value="0" class="w-12 p-1 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div>
                                    <span class="text-2xl font-bold">=</span>
                                 </div>
                                 <div><input type="number" id="defesa-total" readonly class="w-20 h-20 text-4xl font-bold text-center bg-transparent border-2 border-red-800 rounded-full"></div>
                             </div>
                        </div>
                        <div class="p-4 border-2 border-red-800 rounded-lg space-y-2">
                            <div class="grid grid-cols-6 gap-2 text-center text-xs font-medieval text-red-900">
                                <div class="col-span-4 text-left">ARMADURA & ESCUDO</div>
                                <div>Defesa</div>
                                <div>Penalidade</div>
                            </div>
                            <div class="grid grid-cols-6 gap-2 items-center">
                                <select id="select-armadura" class="col-span-4 w-full bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600 transition"></select>
                                <input type="number" id="armadura-defesa-display" readonly class="w-full p-1 text-center bg-stone-200 border border-red-800 rounded-md">
                                <input type="number" id="armadura-penalidade-display" readonly class="w-full p-1 text-center bg-stone-200 border border-red-800 rounded-md">
                            </div>
                            <div class="grid grid-cols-6 gap-2 items-center">
                                <select id="select-escudo" class="col-span-4 w-full bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600 transition"></select>
                                <input type="number" id="escudo-defesa-display" readonly class="w-full p-1 text-center bg-stone-200 border border-red-800 rounded-md">
                                <input type="number" id="escudo-penalidade-display" readonly class="w-full p-1 text-center bg-stone-200 border border-red-800 rounded-md">
                            </div>
                        </div>
                        <div class="p-4 border-2 border-red-800 rounded-lg flex flex-col">
                            <h3 class="font-medieval text-red-900 text-xl mb-2 text-center">Proficiências & Outras Características</h3>
                            <textarea id="proficiencias" name="proficiencias" class="w-full flex-grow p-2 bg-transparent border-2 border-red-800/30 rounded-lg focus:outline-none focus:border-red-600 transition h-24"></textarea>
                        </div>
                    </section>
                    
                    <!-- Habilidades -->
                    <section>
                         <h3 class="font-medieval text-red-900 text-2xl border-b-2 border-red-900 pb-2 mb-4">Habilidades</h3>
                         <div id="habilidades-lista" class="space-y-2"></div>
                         <button id="add-habilidade-row" class="mt-2 text-sm text-red-800 hover:text-red-600">+ Adicionar Habilidade</button>
                    </section>

                    <!-- Magias -->
                    <section class="mt-6">
                        <h3 class="font-medieval text-red-900 text-2xl border-b-2 border-red-900 pb-2 mb-4 text-center">Magias</h3>
                        <div class="p-4 border-2 border-red-800 rounded-lg text-center mb-4">
                            <div class="flex flex-col items-center justify-center gap-4">
                                <div class="flex items-center justify-center gap-2 sm:gap-3 flex-wrap">
                                    <span class="font-bold text-xl">10 +</span>
                                    <div class="flex flex-col items-center">
                                        <label for="magia-cd-attr" class="text-xs">Atributo</label>
                                        <select id="magia-cd-attr" class="w-20 bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600 transition">
                                            <option value="int">INT</option>
                                            <option value="sab">SAB</option>
                                            <option value="car">CAR</option>
                                        </select>
                                    </div>
                                    <span class="text-xl font-bold">+</span>
                                    <div class="flex flex-col items-center"><label for="magia-cd-equip" class="text-xs">Equip.</label><input type="number" id="magia-cd-equip" value="0" class="w-12 p-1 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div>
                                    <span class="text-xl font-bold">+</span>
                                    <div class="flex flex-col items-center"><label for="magia-cd-poder" class="text-xs">Poder</label><input type="number" id="magia-cd-poder" value="0" class="w-12 p-1 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div>
                                    <span class="text-xl font-bold">+</span>
                                    <div class="flex flex-col items-center"><label for="magia-cd-outros" class="text-xs">Outros</label><input type="number" id="magia-cd-outros" value="0" class="w-12 p-1 text-center bg-transparent border-b-2 border-red-800 focus:outline-none focus:border-red-600"></div>
                                    <span class="text-xl font-bold">=</span>
                                </div>
                                <div class="flex items-center justify-center">
                                    <span class="font-medieval text-4xl font-bold text-red-900 mr-2">CD</span>
                                    <input type="number" id="magia-cd-total" readonly class="w-24 h-24 text-4xl font-bold text-center bg-transparent border-2 border-red-800 rounded-full">
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="magias-circulos">
                            <!-- Círculos de Magia serão gerados aqui -->
                        </div>
                    </section>
                </div>

                <!-- COLUNA DA DIREITA -->
                <div class="space-y-6">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="col-span-2"><label for="divindade" class="font-medieval text-red-900">Divindade</label><select id="divindade" name="divindade" class="w-full p-1 bg-transparent border-b-2 border-red-800 rounded-md focus:outline-none focus:border-red-600 transition"><option value="">Selecione</option><option>Nenhuma</option><option>Aharadak</option><option>Allihanna</option><option>Arsenal</option><option>Azgher</option><option>Grande Oceano</option><option>Hyninn</option><option>Kallyadranoch</option><option>Khalmyr</option><option>Lena</option><option>Lin-Wu</option><option>Marah</option><option>Megalokk</option><option>Nimb</option><option>Oceano</option><option>Sszzaas</option><option>Tanna-Toh</option><option>Tenebra</option><option>Thwor</option><option>Thyatis</option><option>Valkaria</option><option>Wynna</option></select></div>
                        <div><label for="nivel" class="font-medieval text-red-900">Nível</label><input type="number" id="nivel" name="nivel" min="1" max="20" value="1" class="w-full p-1 text-center bg-transparent border-b-2 border-red-800 rounded-md focus:outline-none focus:border-red-600 transition"></div>
                    </div>
                    <!-- Perícias -->
                    <section>
                        <h3 class="font-medieval text-red-900 text-2xl border-b-2 border-red-900 pb-2 mb-4">Perícias</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-red-900 uppercase">
                                    <tr>
                                        <th class="py-2 px-1">Perícia</th>
                                        <th class="py-2 px-1 text-center">Total</th>
                                        <th class="py-2 px-1 text-center hidden sm:table-cell">1/2 Nível</th>
                                        <th class="py-2 px-1 text-center hidden sm:table-cell">Mod. Atr.</th>
                                        <th class="py-2 px-1 text-center hidden sm:table-cell">Treino</th>
                                        <th class="py-2 px-1 text-center hidden sm:table-cell">Outros</th>
                                    </tr>
                                </thead>
                                <tbody id="pericias-tabela-body"></tbody>
                            </table>
                        </div>
                        <p class="text-xs mt-2 text-gray-600">✠ Sofre penalidade de armadura. ✯ Exige treinamento.</p>
                    </section>

                    <!-- Equipamento -->
                    <section class="mt-6">
                        <h3 class="font-medieval text-red-900 text-2xl border-b-2 border-red-900 pb-2 mb-4">Equipamento</h3>
                         <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-red-900 uppercase"><tr><th class="p-1 w-3/5">Item</th><th class="p-1 w-1/5 text-center">Espaços</th><th class="p-1 w-1/5 text-center">T$</th></tr></thead>
                                <tbody id="equipamento-tabela"></tbody>
                            </table>
                            <button id="add-equip-row" class="mt-2 text-sm text-red-800 hover:text-red-600">+ Adicionar item</button>
                         </div>
                         <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                             <div><label for="carga-atual" class="block text-sm font-medieval text-red-900">Carga Atual</label><input type="text" id="carga-atual" name="carga-atual" readonly class="w-full p-1 bg-stone-200 border-b-2 border-red-800 text-center"></div>
                             <div><label for="carga-max" class="block text-sm font-medieval text-red-900">Carga Máx.</label><input type="text" id="carga-max" name="carga-max" readonly class="w-full p-1 bg-stone-200 border-b-2 border-red-800 text-center"></div>
                             <div><label for="dinheiro" class="block text-sm font-medieval text-red-900">T$ Total</label><input type="text" id="dinheiro" name="dinheiro" placeholder="0" class="w-full p-1 bg-transparent border-b-2 border-red-800 text-center focus:outline-none focus:border-red-600"></div>
                         </div>
                    </section>
                </div>
            </div>
            
            <!-- Rodapé -->
            <footer class="text-center mt-8 pt-4 border-t-2 border-red-900"><p class="text-xs text-gray-600">Ficha de Tormenta 20. É permitida a reprodução para uso pessoal.</p></footer>
        </div>
    </div>
    
    <!-- Modal de Confirmação -->
    <div id="confirm-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0">
        <div class="bg-white parchment p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="modal-text" class="mb-4">Tem certeza que deseja limpar todos os campos? Esta ação não pode ser desfeita.</p>
            <div class="flex justify-center space-x-4"><button id="modal-confirm-btn" class="bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded">Sim</button><button id="modal-cancel-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Não</button></div>
        </div>
    </div>
    <!-- Biblioteca para gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"
        integrity="sha512-YcsIPGdhPK4P/uRW6/sruonlYj+Q7UHWeKfTAkBW+g83NKM+jMJFJ4iAPfSnVp7BKD4dKMHmVSvICUbE/V1sSw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}
